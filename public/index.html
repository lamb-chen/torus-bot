<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Discord Community Dashboard</title>
  <!-- D3 for charts -->
  <script src="https://d3js.org/d3.v7.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      background: #f7f9fc;
      color: #333;
    }

    header {
      background-color: #4d77ff;
      color: #fff;
      padding: 1.5rem 2rem;
      text-align: center;
    }
    header h1 {
      margin: 0;
      font-size: 1.8rem;
    }

    .container {
      max-width: 1200px;
      margin: 1rem auto;
      padding: 0 1rem;
    }

    /* Summary Cards */
    .summary-cards {
      display: flex;
      flex-wrap: wrap; /* allow wrapping on smaller screens */
      gap: 1rem;
      margin-bottom: 2rem;
    }
    .card {
      flex: 1 1 calc(25% - 1rem); /* 4 cards per row, minus gaps */
      background-color: #fff;
      border-radius: 4px;
      padding: 1.5rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      min-width: 240px; /* ensure a reasonable size even if screen is small */
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    .card h2 {
      margin: 0;
      font-size: 2rem;
    }
    .card p {
      margin: 0.5rem 0 0 0;
      color: #777;
      font-size: 0.9rem;
    }

    /* Charts area */
    .charts-row {
      display: flex;
      flex-wrap: wrap;
      gap: 2rem;
      margin-bottom: 2rem;
    }
    .chart-block {
      flex: 1 1 400px;
      background-color: #fff;
      border-radius: 4px;
      padding: 1rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .chart-block h3 {
      margin-top: 0;
    }

    /* Deeper Insights / Additional Info */
    .insights {
      background-color: #fff;
      border-radius: 4px;
      padding: 1rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 2rem;
    }
    .insights h3 {
      margin-top: 0;
    }
    .insight-item {
      margin-bottom: 1rem;
    }

    footer {
      background-color: #4d77ff;
      color: #fff;
      text-align: center;
      padding: 1rem;
    }
    footer p {
      margin: 0;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header>
    <h1>Discord Community Dashboard</h1>
  </header>

  <!-- MAIN CONTENT CONTAINER -->
  <div class="container">

    <!-- SUMMARY CARDS -->
    <div class="summary-cards">
      <div class="card">
        <h2 id="totalMessages">0</h2>
        <p>Total Messages</p>
      </div>
      <div class="card">
        <h2 id="uniqueUsers">0</h2>
        <p>Unique Users</p>
      </div>
      <div class="card">
        <h2 id="averageMessages">0</h2>
        <p>Avg Messages/User</p>
      </div>
      <div class="card">
        <h2 id="mostActiveChannel">-</h2>
        <p>Most Active Channel</p>
      </div>
    </div>

    <!-- CHARTS ROW -->
    <div class="charts-row">
      <div class="chart-block">
        <h3>Messages Over Time</h3>
        <div id="timeChart"></div>
      </div>
      <div class="chart-block">
        <h3>Top Users (Bar Chart)</h3>
        <div id="topUsersChart"></div>
      </div>
    </div>

    <div class="charts-row">
      <div class="chart-block">
        <h3>Mentions Activity</h3>
        <div id="mentionsChart"></div>
      </div>
      <div class="chart-block">
        <h3>Pinned vs. Unpinned</h3>
        <div id="pinnedChart"></div>
      </div>
    </div>

    <!-- DEEPER INSIGHTS SECTION -->
    <div class="insights">
      <h3>Additional Insights</h3>
      <p class="insight-item" id="peakActivity"></p> <!-- e.g. "Peak activity is 8 PM - 9 PM" -->
      <p class="insight-item" id="mostMentionedUser"></p> <!-- e.g. "Most mentioned user: Alice" -->
      <p class="insight-item" id="mostSharedLinks"></p> <!-- e.g. "Most shared link is..." -->
      <!-- etc. add more interesting bullet points -->
    </div>
  </div><!-- /container -->

  <!-- FOOTER -->
  <footer>
    <p>Generated by Your Discord Bot | Last Updated: <span id="lastUpdated"></span></p>
  </footer>

  <!-- SCRIPT: Fetch and Display Data -->
  <script>
    // On page load, fetch the messages.json file
    document.addEventListener('DOMContentLoaded', () => {
      fetch('messages.json')
        .then(response => response.json())
        .then(data => {
          // 1. Basic aggregated stats
          const totalMessages = data.length;
          const uniqueUsersSet = new Set(data.map(d => d.userId));
          const uniqueUsers = uniqueUsersSet.size;

          // Basic group by user
          const byUser = {};
          data.forEach(msg => {
            byUser[msg.userId] = (byUser[msg.userId] || { count: 0, username: msg.username });
            byUser[msg.userId].count += 1;
          });

          // Average messages per user
          const averageMessages = (totalMessages / uniqueUsers).toFixed(1);

          // Basic group by channel
          const byChannel = {};
          data.forEach(msg => {
            const ch = msg.channelName || 'unknown';
            byChannel[ch] = (byChannel[ch] || 0) + 1;
          });
          // Find the channel with the max messages
          let mostActiveChannel = '-';
          let maxCount = 0;
          for (const chName in byChannel) {
            if (byChannel[chName] > maxCount) {
              mostActiveChannel = chName;
              maxCount = byChannel[chName];
            }
          }

          // Update Summary Cards
          document.getElementById('totalMessages').textContent = totalMessages;
          document.getElementById('uniqueUsers').textContent = uniqueUsers;
          document.getElementById('averageMessages').textContent = averageMessages;
          document.getElementById('mostActiveChannel').textContent = mostActiveChannel;

          // 2. Render Charts
          // 2a. Messages Over Time (Line or Area chart)
          renderTimeChart(data);

          // 2b. Top Users (Bar chart)
          renderTopUsersChart(byUser);

          // 2c. Mentions Activity (Pie or bar)
          renderMentionsChart(data);

          // 2d. Pinned vs. Unpinned (Pie)
          renderPinnedChart(data);

          // 3. Insights text
          document.getElementById('peakActivity').textContent = "Peak activity to be determined...";
          document.getElementById('mostMentionedUser').textContent = "Most mentioned user to be determined...";
          document.getElementById('mostSharedLinks').textContent = "Links analysis not implemented yet...";

          // 4. Last Updated
          document.getElementById('lastUpdated').textContent = new Date().toLocaleString();
        })
        .catch(err => console.error('Error reading messages.json:', err));
    });

    /********************************************************
     * EXAMPLE D3 RENDERING FUNCTIONS
     * (Skeleton placeholders - fill in with real D3 code.)
     ********************************************************/
    function renderTimeChart(data) {
      // 1) Transform data into a { date -> count } structure
      // 2) Sort by date
      // 3) Use D3 line/area chart
      const chartDiv = document.getElementById('timeChart');
      chartDiv.textContent = 'Line Chart placeholder (Implement with D3)';
      // ...
    }

    function renderTopUsersChart(byUser) {
      // Convert 'byUser' object to an array: [ {userId, username, count}, ... ]
      let userArray = Object.keys(byUser).map(uId => ({
        userId: uId,
        username: byUser[uId].username,
        count: byUser[uId].count
      }));
      // Sort descending
      userArray.sort((a, b) => b.count - a.count);
      // Take top 10
      userArray = userArray.slice(0, 10);

      const chartDiv = document.getElementById('topUsersChart');
      chartDiv.textContent = 'Bar Chart placeholder (Implement with D3)';
      // ...
    }

    function renderMentionsChart(data) {
      // You have "mentions.users" array in each message
      // Summarize total mentions of each user, then build a D3 chart
      const chartDiv = document.getElementById('mentionsChart');
      chartDiv.textContent = 'Pie / Bar Chart placeholder (Implement with D3)';
      // ...
    }

    function renderPinnedChart(data) {
      // Summarize pinned vs. unpinned messages
      let pinned = 0;
      data.forEach(msg => {
        if (msg.isPinned) pinned++;
      });
      const unpinned = data.length - pinned;

      const chartDiv = document.getElementById('pinnedChart');
      chartDiv.textContent = 'Pie Chart placeholder (Implement with D3)';
      // ...
    }
  </script>
</body>
</html>
